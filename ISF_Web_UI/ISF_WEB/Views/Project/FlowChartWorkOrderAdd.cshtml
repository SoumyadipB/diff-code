@{
    Layout = "";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Work Flow</title>
    <link rel="icon" type="image/png" href="~/Content/images/Ericsson/favicon.ico" />
    @Scripts.Render("~/bundles/rappid")
    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/bundles/css/jqueryui")

    @*<script src="~/Scripts/select2/select2.full.min.js"></script>*@
    @Scripts.Render("~/bundles/global")
    @Scripts.Render("~/bundles/GetSessionVars")
    @Scripts.Render("~/bundles/config")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/datepicker")
    @Styles.Render("~/bundles/css/rappid")
    @Styles.Render("~/bundles/css/bootstrap")
    @Scripts.Render("~/bundles/DataTableScript")
    @Styles.Render("~/bundles/css/DataTableStyle")
    @Scripts.Render("~/bundles/DataTablesAdvancedScript")
    @Scripts.Render("~/bundles/rowsGroup")
    @Scripts.Render("~/bundles/protip")
    <link href="~/Scripts/lib/tooltip/protip/protip.min.css" rel="stylesheet">
    @Styles.Render("~/bundles/css/select2")
    @Scripts.Render("~/bundles/select2")
    @Scripts.Render("~/bundles/formbuilder")

    @Scripts.Render("~/bundles/ourCustom")
    @Scripts.Render("~/bundles/SessionManagement")
    @*<script src="~/Scripts/Login/AzureADLogin.js"></script>*@
    @*<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">*@
    <script src="~/Scripts/Project/FlowchartJsonPlot.js"></script>
    @*@Scripts.Render("~/bundles/FlowchartJsonPlot")*@
    @Scripts.Render("~/bundles/customConsole")
    @Scripts.Render("~/bundles/ajaxRequest")

    <link type="text/css" rel="stylesheet" href="~/Content/CSS/font-awesome.min.css" />
    <style>
        .WIBackColor {
            background-color: #d9d9d9;
        }

        .joint-select-box-options {
            max-height: 500px;
        }

        .text-danger {
            color: #f44336;
        }

        .joint-lightbox.modal {
            display: block;
        }

        .icon-size {
            font-size: 20px;
        }


        .formInput {
            height: 30px;
        }

        .paper-container {
            height: 90%;
        }

        .joint-toolbar.joint-theme-material button {
            height: 29px;
        }

        /*.navigator-container {
            bottom: 50px;
        }*/

        .joint-popup.joint-theme-material {
            background-color: lightcyan;
            border: 2px solid #31d0c6;
            border-radius: 10px;
            padding: 10px;
            font-family: lato-light,Ari al,sans-serif;
        }

        .popover {
            max-width: 100%;
            /*Max Width of the popover (depending on the container!);*/
        }

        .toolbar-container button.joint-widget[data-type="zoomIn"], .toolbar-container button.joint-widget[data-type="zoomOut"] {
            display: block;
        }

        .joint-app.joint-theme-material .toolbar-container {
            overflow-y: unset;
        }


        ul.select2-selection__rendered {
            padding-right: 12px !important;
            max-width: 100%;
            height: 75px !important;
        }

        .select2-container .select2-selection--multiple .select2-selection__rendered {
            overflow-y: scroll !important;
            overflow-x: scroll !important;
            width: 85px !important;
        }
        /*For Rappid overwrite*/
        .app-title h1 {
            font-size: 12px;
            line-height: 33px !important;
        }

        .app-header {
            height: 28px !important;
        }

        .joint-widget.joint-theme-material[data-type=zoomToFit]:after {
            background-position: 0px -39px;
        }

        .joint-widget.joint-theme-material[data-type=zoomOut]:after {
            background-position: -62px -4px;
        }

        .joint-widget.joint-theme-material[data-type=zoomIn]:after {
            background-position: -27px -39px;
        }

        .joint-widget.joint-theme-material[data-type=fullscreen]:after {
            background-position: -58px -33px;
        }

        .joint-widget.joint-theme-material[data-name=layout]:after {
            background-position: -3px -72px;
        }

        .joint-widget.joint-theme-material[data-name=layout]:after, .joint-widget.joint-theme-material[data-type=undo]:after, .joint-widget.joint-theme-material[data-type=redo]:after, .joint-widget.joint-theme-material[data-type=zoomToFit]:after, .joint-widget.joint-theme-material[data-type=zoomIn]:after, .joint-widget.joint-theme-material[data-type=zoomOut]:after, .joint-widget.joint-theme-material[data-type=fullscreen]:after {
            background-size: 92px;
        }

        .stencil-container {
            max-height: 90%;
        }
        /*Navigater*/
        .joint-navigator {
            right: 18px !important;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #fdfdfd;
        }

            .joint-navigator.joint-theme-material {
                width: 166px !important;
                padding: 0px;
                padding-left: 57px;
                /*// padding-left: 49px !important;*/
            }

        .navigator-container {
            /*bottom: 156px !important;
            right: 263px;*/
            /*bottom: 81px !important;*/
            right: 167px;
            position: fixed;
            /*right: 0;*/
            bottom: 60px;
            width: 240px;
            height: 120px;
            margin-right: 15px;
        }

        .inspector-container {
            bottom: 0px;
            max-height: 90%;
        }

        .joint-inspector.joint-theme-material {
            /*//max-height:471px;*/
            font-family: 'Ericsson Hilda' !important;
        }
        /*.joint-inspector .content-editable {
            white-space: pre-wrap;
            letter-spacing: 1px;
        }*/


        .joint-select-button-group.joint-theme-material {
            display: none;
        }

        .more-less {
            float: right;
            color: #212121;
        }

        .panel-default > .panel-heading + .panel-collapse > .panel-body {
            border-top-color: #EEEEEE;
        }

        .validateArea {
            position: absolute;
            right: 263px;
            z-index: 2;
            top: 125%;
            padding: 0 15px !important;
        }

        .selectwidth .select2-search__field {
            width: 74px !important;
        }

        li.select2-selection__choice {
            /*max-width: 100%;*/
            overflow: hidden;
            /*Altered two below to make word wrap work */
            word-wrap: normal !important;
            white-space: normal;
        }

        .PMDRListDiv .select2-container.select2-container--classic {
            width: 200px !important;
        }

        ul.select2-selection__rendered {
            padding-right: 12px !important;
        }

        .PMDRListDiv .select2-container.select2-container--classic {
            width: 200px !important;
        }

        .tooltip-inner {
            max-width: none;
            word-break: normal;
        }

        .aqua-tooltip + .tooltip > .tooltip-inner {
            background-color: #339996;
        }

        .aqua-tooltip + .tooltip > .tooltip-arrow {
            border-top-color: #339996;
            border-bottom-color: #339996
        }

        .btn-disabled {
            color: white;
            background-color: #808080cf;
        }

        .ruleLink {
            cursor: pointer;
            font-weight: 500;
            position: absolute;
            right: 0;
            padding-right: 20px;
        }

        div.dataTables_length {
            margin-right: 1em;
        }

        .iHide {
            display: none;
        }

        .editing {
            /*font-size:medium;*/
            color: mediumpurple;
        }

        .edited {
            color: green;
        }

        .iURL {
            max-width: 380px;
            /*min-height:40px;*/
            overflow: auto;
        }

        .iAction {
            /*max-width:50px;*/
            min-width: 50px;
        }

        .iName {
            overflow: auto;
            max-width: 200px;
        }

        .close {
            opacity: 0.9;
        }

        .iHideStep {
            display: none;
        }

        .editingStep {
            /*font-size:medium;*/
            color: mediumpurple;
        }

        .deletingStep {
            /*font-size:medium;*/
            color: purple;
        }

        .editedStep {
            color: green;
        }

        .iURLStep {
            max-width: 120px;
            /*min-height:40px;*/
            overflow: auto;
        }

        .iActionStep {
            max-width: 85px;
            min-width: 40px;
        }

        .iNameStep {
            padding-right: 2px;
            width: 112px;
            overflow: auto;
            max-width: 140px;
        }

        ul#mylist li {
            display: inline;
            text-align: center;
            margin: 0 10%;
        }

        div#instBtnDiv > ul {
            padding: 0;
            list-style: none;
            font-size: 0;
            float: left;
        }

            div#instBtnDiv > ul li:nth-child(2) {
                clear: both;
                font-size: 14px;
                display: block;
                color: #cb211c;
                float: left;
            }

       /* #botSavingTable tr {
            height: 100px !important;
        }*/

        .overlayWfDetailDiv {
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3;
            position: fixed;
        }

        .wfDetailHr {
            margin-bottom: 4px;
            margin-top: 4px;
        }

        .flowchartFooter {
            position: fixed;
            opacity: 70%;
            bottom: 0;
            z-index: 4;
            right: 0;
            left: 0;
            background-color: black;
        }

        .wfHeader {
            font-size: 14px;
        }

        .selectStyle {
            border-color: #ccc;
        }
    </style>

</head>
<body style="padding-top:0px !important">
	<input type="hidden" id="max_id" />

	<div align="center" class="" id="mainDivToOverlay" style="margin-bottom: -26px;">
		<div class="panel panel-default" id="wfpanel" style="width: 98%;margin-top: 5px;">
			<div class="panel-heading">
				<a role="button" id="linkcollapse" data-toggle="collapse" data-parent="#wfpanel" href="#accordionOne" aria-expanded="true" aria-controls="accordionOne">
					<i class="more-less fa fa-plus"></i>

					<!-- panel-heading -->
					<h4 class="panel-title wfHeader">
						<!-- title 1 -->
						@*<a data-toggle="collapse" data-parent="#accordion" href="#accordionOne">*@
						WorkFlow Details
						@*</a>*@
					</h4>
				</a>
			</div>

            <div id="accordionOne" class="panel-collapse collapse">
                <div class="panel-body" style="padding-left: 10px; padding-right: 10px;z-index:1:">
                    <input type="hidden" id="hiddenWfid" />
                    <div class="row" style="margin-bottom: 8px;">
                        <div class="col-md-2 input-group">
                            <span id="basic-addon3" style="padding-right:200px;">WF Name: </span>
                            @*<input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">*@
                            <input type="text" class="form-control formInput" id="WFName" aria-describedby="basic-addon3" onkeypress="return IsAlphaNumeric(event);" ondrop="return false;"
                                   onpaste="return isPaste(event);" onkeyup="checkForInputWFName();" />
                        </div>
                        <div class="col-md-2 input-group">
                            <span style="padding-right:217px;" id="basic-addon3">Owner: </span>
                            @*<input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">*@
                            <input type="text" class="form-control formInput" id="WFOwnerName" aria-describedby="basic-addon3" />
                            <span class="input-group-btn" style="padding-top:17px;">
                                <button class="btn btn-default" type="button" data-target="#editRep" data-toggle="modal" onclick="retrivePMDRList(projID)" style="height:30px;">
                                    <i class="fa fa-edit"></i> Edit
                                </button>
                            </span>
                        </div>


						@*<div class="col-md-2" style="margin-left: -40px; width: 290px;">WorkFlow Name:<span class="pull-right"><input id="WFName" type="text" style="width: 149px" /></span></div>*@
						<div class="col-md-3 input-group" id="SlaHourDiv">
							<span id="basic-addon3" style="padding-right:223px;">SLA Hours: </span>
							<input type="text" class="form-control formInput" id="SLAHours" aria-describedby="basic-addon3" onkeyup="NumberOnlySLA(this)"  />
						</div>

						<div class="col-md-2 input-group" id="projectIdDiv">
							<span id="basic-addon3" style="padding-right:46px;">Project ID(Read Only):</span>
							<input type="text" class="form-control formInput" id="projectId" aria-describedby="basic-addon3" readonly  />
						</div>




					</div>

                    <div class="row" style="margin-bottom:8px;">
                        @*<br><br>
        <span id="error" style="color: Red; display: none">* Special Characters not allowed</span>*@


                        <div class="col-md-2 input-group" id="ftrDiv">

                            <label style="padding-right:217px; margin-bottom:0px" id="basic-addon3">
                                FTR:
                            </label>
                            <select id="ftr" style="height:30px; width:236px" class="selectStyle" onchange="onFTRChange();">
                                <option value="-1" selected disabled>--Select One--</option>
                                <option value="FTR1">FTR1</option>
                                <option value="FTR2">FTR2</option>
                                <option value="FTR3">FTR3</option>
                                <option value="NA">NA</option>
                            </select>
                        </div>
                        <div class="col-md-2 input-group" id="editReasonDiv">
                            <label id="basic-addon3" style="padding-right:205px; margin-bottom:0px">Reason: </label>
                            <select id="editReasonDD" style="height:30px; width:247px" class="selectStyle" onchange="onReasonChange()"></select>
                        </div>

                        <div class="col-md-2 input-group" style="height: 34px; padding-left: 0px;padding-right: 0px; padding-top:26px;" id="neMandateDiv">
                            <span>
                                <input id="IsNEMandortoryCheck" type="checkbox" aria-label="..." checked="checked">
                            </span>
                            <span id="basic-addon3">Is Network Element Mandatory?</span>

                        </div>
                        <div class="col-md-3 input-group" id="isAutoSenseDiv" style="height: 34px; padding-top:27px;">
                            <span>
                                <input id="IsAutoSenseDisabled" type="checkbox" aria-label="..." checked="checked" disabled >
                            </span>
                            <span id="basic-addon3">Disable Autosense for complete WF</span>
                        </div>

                    </div>
                    <div class="row" style="margin-bottom:8px">
                        <div class="col-md-1 input-group" id="loeDiv">

                            <label style="padding-right:134px; margin-bottom:0px" id="loeMeasurement">
                               LOE Measurement:
                            </label>
                            <select id="loe" style="height:30px; width:236px" class="selectStyle" onchange="onLoeChange()">
                                <option value="-1" selected disabled>--Select One--</option>   
                            </select>
                        </div>

                    </div>

					<hr class="wfDetailHr" />
					<div class="row" style="margin-bottom:8px">

						@*<div class="col-md-3 input-group" id="projectIdDiv">
								<span class="input-group-addon" id="basic-addon3">Project ID:</span>
								<input type="text" class="form-control" id="projectId" aria-describedby="basic-addon3" readonly />
							</div>
							<div class="col-md-3 input-group" id="SlaHourDiv">
								<span class="input-group-addon" id="basic-addon3">SLA Hours: </span>
								<input type="text" class="form-control" id="SLAHours" aria-describedby="basic-addon3" onkeyup="NumberOnly(this)" />
							</div>*@
						@*<div class="col-md-2 input-group" style="height: 34px; padding-left: 0px;padding-right: 0px;" id="neMandateDiv">
								<span class="input-group-addon">
									<input id="IsNEMandortoryCheck" type="checkbox" aria-label="..." checked="checked">
								</span>
								<span class="input-group-addon" id="basic-addon3">Is Network Element Mandatory?</span>

							</div>*@

						<div id="isWfInstructionDiv" class="col-md-3 input-group" style="height: 34px; line-height:5; padding-right:92px;">
							<span>
								<input id="wfInstrcutionUpdated" class="IsWFInsUpdateCheck" disabled type="checkbox" aria-label="...">
							</span>
							<span id="basic-addon5">Workflow instruction updated ?</span>


						</div>
						<div id="instBtnDiv" class="col-md-3 input-group" style="height: 34px;padding-top:9px;">

							<button id="instructionBtn" disabled title="WorkFlow Instruction URL" onclick="checkOwner(); setoutside();" pull-right class="btn btn-danger" style=" clear: both; position: relative;float: left;" data-toggle="modal">Add WI-URL</button>

							<span id="instructionText" style="color:red;line-height:3">WI-URL not added Yet</span>

						</div>
						<div id="multiModeDiv" class="col-md-3 input-group" style="height: 34px;line-height:5;">
							<span>
								<input id="multiModeCheck" class="multiModeCheck" type="checkbox" aria-label="...">
							</span>
							<span id="basic-addon4">Multi-Mode Execution?</span>
							<i class="circle fa fa-info-circle protip" data-toggle="tooltip" data-pt-scheme="aqua" data-pt-position="bottom" data-pt-skin="square" data-pt-width="400" data-pt-size="small" data-pt-title="is multi-mode like Experienced (earlier known as Qualified) needed?" aria-hidden="true" style="padding-left:6px;color:blue;"></i>
						</div>
						<div id="resetProficiencyDiv" class="col-md-3 input-group" style="height: 34px;line-height:5;">
							<span>
								<input id="resetProficiencyCheck" class="resetProficiencyCheck" type="checkbox" aria-label="...">
							</span>
							<span id="basic-addon4">Reset Proficiency?</span>
							<i class="circle fa fa-info-circle  protip" data-toggle="tooltip" data-pt-scheme="aqua" data-pt-position="bottom" data-pt-skin="square" data-pt-width="400" data-pt-size="small" data-pt-title="All existing engineers at EF-WF level will be trigger back to AF-WF in the assigned & new WO’s" aria-hidden="true" style="padding-left:6px;color:blue;"></i>
						</div>
					</div>

					<hr class="wfDetailHr" style="margin-top:-8px;" />

					<div id="multiModeViewDiv" hidden>
                        <div class="row">
                            <div class="col-md-2 input-group" id="transitionFwdDiv">

                                <label style="padding-right:117px; margin-bottom:0px;" id="basic-addon3">
                                    Transition Criteria:
                                    <i class="circle fa fa-info-circle protip" data-toggle="tooltip" data-pt-scheme="aqua" data-pt-position="bottom" data-pt-skin="square" data-pt-width="400" data-pt-size="small" data-pt-title="Forward WorkFlow Transition" aria-hidden="true" style="padding-left:6px;color:blue;"></i>
                                </label>

                                <select id="transitionFwd" class="selectStyle" style="height:30px; width:236px" onchange="getListOfFwdKPI();"></select>
                            </div>
                            <div id="listOfFwdKPIdiv"></div>                         
                        
                        </div>

						<div class="row" style="padding-top:9px;">
							<div class="col-md-2 input-group" id="transitionBckDiv" >

								<label style="padding-right:117px; margin-bottom:0px;" id="basic-addon3">
									Transition Criteria:
									<i class="circle fa fa-info-circle protip" data-toggle="tooltip" data-pt-scheme="aqua" data-pt-position="bottom" data-pt-skin="square" data-pt-width="400" data-pt-size="small" data-pt-title="Reverse WorkFlow Transition" aria-hidden="true" style="padding-left:6px;color:blue;"></i>
								</label>

								<select id="transitionBck" class="selectStyle" style="height:30px; width:236px" onchange="getListOfBckKPI();"></select>
							</div>
							<div id="listOfKPIBckDiv" style="margin-bottom:0px;"></div>
						
						</div>
					</div>
				
					<hr class="wfDetailHr" />
					<div class="row" style="margin-top:-10px;">
						<div align="left" class="col-md-12" id="importUploadDiv">
							<br>
							<h4 style="margin-top: 0px;font-size:14px;">Import File</h4>
						</div>
					</div>

					<div class="row">
						<form method="POST" enctype="multipart/form-data" id="fileUploadForm">
							<div class="col-md-4" input-group>
								<input type="file" id="myFile" class="form-control" aria-describedby="basic-addon3" required />
								<label style="color: red;margin-top: 5px;float:left;">Note:Please upload only <bold>.xlsx</bold> file</label>
							</div>
						</form>

						<div class="col-md-3">
							<input type="submit" class="btn btn-default" value="Preview" id="btnPreview" style="width: 200px;" disabled />
						</div>
						<div class="col-md-2">
							<input type="hidden" id="hiddenAssessedwfname" />
							<input type="hidden" id="hiddenExperiencedwfname" />
							<input type="hidden" id="assesedDefid" value="0" />
							<input type="hidden" id="experiencedDefid" value="0" />
                            <input type="hidden" id="mandatoryInputFlag" />
                            <input type="hidden" id="stepIDforCurrentStep" />
							@*<label title="Under Maintainance">*@
							<input type="button" class="btn btn-default" id="viewExsistingWorkOrderModal" value="Import from existing" style="width: 200px;">
							@*</label>*@
						</div>
					</div>

					@*<div id="saveAndaddStep" style="float:right;margin-top:-18px;">
							<div class="col-md-2">
								<span><button id="saveJSON" disabled="disabled" class="btn btn-success" onclick="savejson()">Save Work Flow (Validate work flow first)</button></span>
								<span><button id="saveWFAttributes" class="btn btn-success" style="display:none; width: 200px;" onclick="updateWFAttributes()">Update WorkFlow Attributes</button></span>
							</div>
						</div>*@

				</div>
			</div>


		</div>
	</div>

	<div class="container" style="max-width:1500px;">
		<br />
		<div id="editRep" class="modal fade" role="dialog" style="overflow:auto; z-index:1035 !important;" aria-labelledby="updateWFOwner" data-backdrop="static" data-keyboard="false">
			<div class="modal-content">
				<div class="modal-header">
				</div>
				<div class="modal-body" id="editInfo">
					<div class="col-lg-3 pull-left PMDRListDiv" id="PMDRListDiv">
						PM/DR:
						<select class="select2able select2-offscreen PMDRList" id="PMDRList" style="width:200px;">
							<option value="0"></option>
						</select>
					</div>
				</div>
				<div class="modal-footer">
					<button id="updateWFOwner" class="btn btn-primary" type="submit" onclick="updateWfOwner($('#PMDRList').val(), $('#assesedDefid').val())">Save</button>
					@*<a id="submitModal" class="btn btn-primary" onclick="modalClose()">Close</a>*@
					<button id="closeModal" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
		<div class="modal fade" id="viewExsistingWorkOrder" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document" style="width: 86%">
				<div class="modal-content">
					<div class="modal-header" style="background-color:#d9edf7">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title text-center" id="myModalLabel">View Existing Sub Activities</h4>
					</div>
					<div class="modal-body" style="max-height: calc(110vh - 210px);overflow-y: auto;">
						<div class="row">
							<div class="col-lg-12">
								<div class="dataTable_wrapper">
									<table class="table table-striped table-bordered table-hover" id="exsistingSub"></table>
								</div>
							</div>
						</div> <!--//Table  -->
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="previewErrorDetials" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document" style="overflow-y: initial !important">
				<div class="modal-content">
					<div class="modal-header" style="background-color:#d9edf7">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title text-center" id="myModalLabelpreviewErrorDetials">ERRORS</h4>
					</div>
					<div class="modal-body" style="max-height: calc(100vh - 210px);overflow-y: auto;">
						<div class="row">
							<div class="col-lg-12">
								<div class="dataTable_wrapper">
									<table class="table table-striped table-bordered table-hover" id="dataTablepreviewErrorDetials">
										<thead>
											<tr>
												<th>Error Description</th>
												<th>Error Details</th>
												<th>How To Fix</th>

											</tr>
										</thead>
										<tbody id="dataTablepreviewErrorDetials_tBody">
											<tr><td colspan="10" align="center"><img src="~/Content/images/loading-1.gif" style="width:70px;height:70px;"></td></tr>
										</tbody>

									</table>
								</div>
							</div>
						</div> <!--//Table  -->
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="botConfigModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg" role="document" style="width: 86%" ;overflow-y initial !important">
				<div class="modal-content">
					<div class="modal-header" style="background-color:#d9edf7">
						@*<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>*@
						<h4 class="modal-title text-center" id="">BOT Config</h4>
					</div>
					<div class="modal-body" style="max-height: calc(100vh - 210px);overflow-y: auto;">
						<div class="row">
							<div class="col-lg-12">
								<input type="hidden" id="currentCellID" />

								<form method="POST" id="botConfigForm">
									<div class="dataTable_wrapper" id="botConfigBody">
									</div>
									<button type="submit" onclick="" class="btn btn-primary" id="saveBotConfigBtn">Save</button>

									@*<button type="submit" onclick="saveBotConfig()" id="saveBotConfigBtn">Save</button>*@
								</form>
							</div>
						</div> <!--//Table  -->
					</div>
				</div>
			</div>
		</div>

		<div class="row" id="saveAndaddStep"></div>
		@*<br />*@
		<div class="row">
			<div class="col-md-2" id="editWF" style="display:none;"><span><a href="#" class="btn btn-sm btn-primary" onclick="flowChartOpenInNewWindow('FlowChartWorkOrderView?subId=' + subID + '&projID=' + projId + '&version=' + version)">Edit WorkFlow</a></span></div>
		</div>



		<div class="modal fade" id="saveVersionedWF" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<!--<h4 class="modal-title" id="scopeTitleModal">Work Order</h4>-->
					</div>
					<div class="modal-body" id="versionContentModal">
						<label>Do you want to Overwrite WorkFlow with same name?</label>
					</div>
					<div class="modal-footer">
						@*<button id="existingWFVersion" type="button" class="btn btn-default" onclick="ViewsaveJsonfromUI(projID, subID, subActivityDefID, version, $('#WFName').text(), true, '1')" data-dismiss="modal">Create new with exsisting name</button>*@
						<button id="" type="button" class="btn btn-default" onclick="saveJsonfromUI(projId, subID, subActivityDefID, false, version, flag, $('#WFName').val(),'updateexisting')">Yes</button>
						<button id="" type="button" class="btn btn-default" onclick="createNew()">No</button>
						@*<button id="existingWFVersion" type="button" class="btn btn-default" onclick="ViewsaveJsonfromUI(projID, subID, subActivityDefID, version, $('#WFName').text(), false,'3')" data-dismiss="modal">Update Existing</button>*@

					</div>
				</div>
			</div>
		</div>

	</div>

    <div class="modal fade" id="experiencedPreviewModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document" style="width: 70%;">
            <div class=" modal-content">
                <div class="modal-header" style="height:35px">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="scopeTitleModal" style="line-height:0.42">Experienced Preview</h4>
                </div>
                <div class="modal-body" id="WFBody" style="height:600px;margin:0px;">
                   
                    @*<img src="~/Content/images/loading-1.gif" id="loading" style="width:70px; height:70px; margin-top: -35px; margin-left:50%;" />*@
                    <div class="expPrev container" id="app2" style="max-width:1500px">
                        <div class="app-header" style="height:43px">
                            <div class="app-title">
                                <h1>WORK FLOW</h1>
                            </div>
                            <div class="toolbar-container"></div>
                        </div>
                        <div class="app-body" style="height:95%">
                            <div class="stencil-container" style="display:none"></div>
                            <div class="paper-container" style="height:100%"></div>
                            <div class="inspector-container" style="display:none"></div>
                            <div class="navigator-container" style="display:none"></div>
                        </div>
                    </div>


                </div>
              
            </div>
        </div>
    </div>


	<div class="modal fade" id="previewWF" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog modal-lg" role="document" style="width: 70%;">
			<div class=" modal-content">
				<div class="modal-header" style="height:35px;">
					@*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
					<h4 class="modal-title" id="scopeTitleModal" style="line-height:0.42">Preview</h4>
				</div>
				<div class="modal-body" id="WFBody" style="height: 676px;margin:0px;padding:0px;">
					<br />
					@*<img src="~/Content/images/loading-1.gif" id="loading" style="width:70px; height:70px; margin-top: -35px; margin-left:50%;" />*@
					<div class=" container" id="app1" style="max-width:1500px">
						<div class="row ">
							<button id="rejectWFModal" type="button" class="btn btn-link pull-right" onclick="rejectWF()">Cancel</button>&nbsp;&nbsp;
							<button id="okWFModal" type="button" class="btn btn-link pull-right" onclick="acceptWF()" data-dismiss="modal">OK</button>&nbsp;&nbsp;
							@*saveJsonfromUI(projId,subID,version,2)*@
						</div>
						<div class="app-header" style="height:43px">
							<div class="app-title">
								<h1>WORK FLOW</h1>
							</div>
							<div class="toolbar-container"></div>
						</div>
						<div class="app-body">
							<div class="stencil-container" style="display:none"></div>
							<div class="paper-container"></div>
							<div class="inspector-container" style="display:none"></div>
							<div class="navigator-container"></div>
						</div>
					</div>


				</div>
				<div class="modal-footer">

				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="pdfDiv" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog modal-lg" role="document" style="width: 70%;">
			<div class=" modal-content">
				<div class="modal-header">
					@*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
					<h4 class="modal-title" id="scopeTitleModal">Work Instruction</h4>
				</div>
				<div class="modal-body" id="WFBody" style="height: 676px;">
					<br />

					<object id="objpdf" width="100%" height="100%" type="application/pdf" data="">
						@*<embed id="embedpdf" type="application/pdf" />*@
					</object>
				</div>
				<div class="modal-footer">

				</div>
			</div>
		</div>
	</div>

	@*BOT Saving*@
	<!--<div class="modal fade" id="botDetailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-lg" role="document" style="width: 70%;">
			<div class=" modal-content">
				<div class="modal-header" style="background-color: lightgray;height: 40px;">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="deleteAllBotDetails()">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="scopeTitleModal" style="text-align:center">BOT SAVING DETAILS</h4>
				</div>
				<div class="modal-body" id="BotSavingDetails" style="height: 570px; overflow:auto">

					<label>Deleted Step Details</label>
					<table id="deletedStepTable" class="table table-striped table-bordered table-hover" style="width:100%"></table>

					<br />
					<label>New/Modified Step Details</label>
					<table id="newStepTable" class="table table-striped table-bordered table-hover" style="width:100%"></table>
					<br />
					<label style="font-size:10px; color:red">Note: Calculate all the savings from other project if available to calculate the final savings.</label><br />-->
					@*<div class="pull-right">
							<label>Choose Another WF: </label>&nbsp;&nbsp;<select id="wfVersionSelect" class="" style="margin-bottom:10px"><option value="208">208</option></select>&nbsp;&nbsp;<a class="icon-view lsp" onclick="viewVersionFlowChart()" title="View Workflow" href="#"><i class="fa fa-eye"></i></a>
						</div>*@
					<!--<label>Bot Saving Details</label>
					<table id="botSavingTable" class="table table-striped table-bordered table-hover" style="width:100%; table-layout:fixed"></table>


				</div>
				<div class="modal-footer">
					<button type="button" id="saveBotDetailsBtn" class="btn-primary" onclick="saveAllBotDetails()" disabled>Save</button>
					<button id="cancelBotDetailsBtn" class="btn-default" data-dismiss="modal" onclick="deleteAllBotDetails()">Cancel</button>
				</div>
			</div>
		</div>
	</div>-->
<div>
    @Html.Partial("_BotSavingPopup", "flowChartAdd");
</div>

	<div class="container" id="app" style="max-width:1500px;">

		<div class="app-header" style="height:43px">
			<div class="app-title">
				<h1>WORK FLOW</h1>
			</div>
			<div class="toolbar-container"></div>
		</div>
		<div class="app-body">
			<div class="stencil-container"></div>
			<div class="paper-container"></div>
			<div class="inspector-container"></div>
			<div class="navigator-container"></div>
		</div>
	</div>

	<div class="footer flowchartFooter">
		<div class="container">
			<div class="row" id="saveBtnDiv" style="text-align:right;padding-top: 3px;">
				<span style="padding-right:14px;" hidden id="experienceBtn"><button id="experiencedView" class="btn btn-primary" style="height:34px;" onclick="openExperienceViewDialog()">Experienced Preview</button></span>
				<span><button id="saveJSON" class="btn btn-success" onclick="savejson()">Validate and Save Work Flow</button></span>
			</div>
		</div>
	</div>

	@*Auto Sense Rules based on Task ID and Project ID*@
	<div class="modal fade" id="rulesTaskProject" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-lg" role="document" style="width: 70%;">
			<div class=" modal-content">
				<div class="modal-header" style="border: 0.1px solid #ccc; border-radius: 3px/6px; box-shadow: #0000006b 0px 1px 5px; padding: 10px;">
					<button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" style="margin-top: -2.5px; float: right; margin-right: 0px;">
						<span aria-hidden="true">X</span>
					</button>
					<h4 class="modal-title" id="ruleTypeTitle" style="font-weight: bold;"></h4>
				</div>
				<div class="modal-body">

					<div id="ruleLinkDiv">
						<a id="filterByTask" class="ruleLink" onclick="getAllRulesByTask($('#taskIDforRules').val(), $('#ruleType').val());">
							<i class="fa fa-paper-plane"></i>&nbsp;SHOW ALL RULES
						</a>
						<a id="filterByTaskAndProject" class="ruleLink" onclick="getAllRulesByProjectAndTask($('#projectIDforRules').val(), $('#cellIDforRules').val(), $('#ruleType').val());" style="display:none">
							<i class="fa fa-filter"></i>&nbsp;FILTER RULES BY PROJECT
						</a>
					</div>

					<div id="addedRuleDiv" style="display:none">
						<label>Added Rule</label>
						<div class="row" style="margin-bottom: 15px; background: #F2F2F2; border: 0.1px solid #ccc; border-radius: 3px/6px; box-shadow: #000000ad 0px 1px 5px; margin-left: 0px; margin-right: 0px;">
							<div class="col-lg-4" style="margin-top: 5px;margin-bottom: 5px;padding-left: 10px;padding-right: 10px;">
								<div class="row">
									<input type="hidden" id="ruleId" value="" />
									<div class="col-lg-4" style="margin-top: 5px; margin-bottom: 5px; padding-right: 14px;">
										<label style="color: #2455ad; margin-bottom: 0px;">Rule Name:</label>
									</div>
									<div class="col-lg-8 aqua-tooltip" data-toggle="tooltip" id="ruleName" style="margin-top: 5px; margin-bottom: 5px; padding-left: 0px;padding-right: 5px; width: fit-content">

									</div>
								</div>
							</div>
							<div class="col-lg-7" style="margin-top: 5px;margin-bottom: 5px;padding-left: 0px;">
								<div class="row">
									<div class="col-lg-3" style="margin-top: 5px; margin-bottom: 5px; padding-left: 5px;padding-right: 0px;">
										<label style="color: #2455ad; margin-bottom: 0px;">Rule Description:</label>
									</div>
									<div class="col-lg-9 aqua-tooltip" data-toggle="tooltip" id="ruleDescription" style="margin-top: 5px; margin-bottom: 5px; padding-left: 0px;padding-right: 0px; right: 10px; width: fit-content">

									</div>
								</div>
							</div>
							<div class="col-lg-1 aqua-tooltip" data-toggle="tooltip" title="Delete this rule" onclick="deleteRule($('#cellIDforRules').val(), $('#ruleType').val())" style="margin-top: 8px;margin-bottom: 5px;padding-right: 0px;padding-left: 30px;">
								<button class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></button>
							</div>
						</div>
					</div>

					<h4 id="noDataHeader" style="color: #ff0000b8; margin-top: 0px; margin-bottom: 0px; text-align: center; display: none;">
						No data available!
					</h4>
					<div id="allRulesTableDiv" style=" padding-top: 5px;">
						<table class="table table-bordered table-striped table-hover" id="allRulesTable">
						</table>
					</div>
				</div>
				<div class="modal-footer" style="margin-top: 0px;">
					<div style="text-align:center;">
						<input type="hidden" id="taskIDforRules" value="" />
						<input type="hidden" id="projectIDforRules" value="" />
						<input type="hidden" id="cellIDforRules" value="" />
						<input type="hidden" id="ruleType" value="" />
						<button type="button" id="addRuleButton" class="btn btn-disabled" style="text-align:center" onclick="addOrUpdateRuleInTempTable()" disabled>Add and Close this popup</button>
					</div>
				</div>
			</div>
		</div>
	</div>


	@*nahar*@
	<div class="modal fade " id="addInstruction" role="dialog" style="overflow:auto;z-index:10003">
		<div class="modal-dialog">
			<div class="modal-content" style="position: relative;top: 90px; width:120%">
				<div class="modal-header" style="padding:8px;">
					<b>WorkFlow Instruction URL</b>
					<button type="button" class="close" style="position:relative;" data-dismiss="modal">&times;</button>
					@*<button onclick="fetchWfLevelInstructioFromTable()">Testing</button>*@
				</div>
				<div class="modal-body " id="updateInstruction" style="padding:12px;">
					<div class="row" style="width:100%" id="WIrow">
						<div class="col-sm-3">
							<label>Name :<a class="text-danger">*</a> </label>
							<input type="text" id="instructionName" style="width:150px;" onkeyup="stoppedTyping()" class="form-control input-sm" maxlength="20" placeholder="Name" />
						</div>
						<div class="col-sm-8">
							<label>URL: <a class="text-danger">*</a></label>
							<input type="url" id="instructionURL" onkeyup="stoppedTyping()" class="form-control input-sm" maxlength="500" placeholder="URL" />
						</div>

						<div class="col-sm-1" style="margin-top:21px;">
							<button id="addInstructionBtn" type="submit" value="Add" onclick="addInstruction(this)" class="btn btn-primary " disabled>Add</button>
						</div>

					</div>

					<div>
						<table class="table table-striped table-bordered table-hover" id="wfInstructionTable">
							<tr>
								<th class="iHide">ID</th>
								<th class="iAction">Action</th>
								<th>Name</th>
								<th>URL</th>
								<th class="iHide">isEdited</th>
								<th class="iHide">isDelete</th>

							</tr>
						</table>
					</div>

				</div>
			</div>
		</div>

	</div>



	@*STEP Level*@
	<div class="modal fade " id="addInstructionStep" role="dialog">
		<div class="modal-dialog" id="stepInstructionModalDialog">
			<div class="modal-content" style="position: relative;top: 220px;left: 40px;width: 650px;">
				<div class="modal-header" style="padding-bottom:10px;height: 36px;padding-top: 11px;">
					<b>Step Level Instruction URL</b>
					<button type="button" class="close" data-dismiss="modal" onclick="AddURLbuttonNameSet($('#stepIdIdentifier').val()); " style="position: relative;bottom: 6px;">&times;</button>
					@*<button onclick="fetchWfLevelInstructioFromTableStep()">Testing</button>*@
				</div>
				<div class="modal-body " id="updateInstructionStep" style="padding-right: 5px;padding-top: 5px;padding-left: 5px;padding-bottom: 0px;">
					<input type="hidden" id="stepIdIdentifier" />
					<div class="row" style="width:100%" id="WIstepRow">
						<div class="col-sm-3" style="padding-right: 8px;">
							<label>Name : <a class="text-danger">*</a></label>
							<input type="text" id="instructionNameStep" onkeyup="stoppedTypingStep()" class="form-control" maxlength="20" placeholder="Name" />
						</div>
						<div class="col-sm-5" style="padding-left: 0px;padding-right: 1px;margin-right: 0px;">
							<label>URL:<a class="text-danger">*</a></label>
							<input type="url" id="instructionURLStep" onkeyup="stoppedTypingStep()" class="form-control " maxlength="500" placeholder="URL" />
						</div>
						<div class="col-sm-3" style="margin-left: 0px;padding-right: 0px;padding-left: 8px;">
							<label>Reference:</label>
							<input type="text" id="instructionReferenceStep" onkeyup="stoppedTypingStep()" class="form-control " maxlength="20" placeholder="Reference" />
						</div>
						<div class="col-sm-1" style="margin-top:23px;width: 50px;padding-right: 8px;padding-left: 8px;">
							<button id="addInstructionBtnStep" type="submit" value="Add" onclick="addInstructionStep(this)" class="btn btn-primary " style="padding-left: 18px;padding-right: 18px;" disabled>Add</button>
						</div>

					</div>

					<div>
						<input type="hidden" id="TablestepIdIdentifier" />
						<table class="table table-striped table-bordered table-hover" id="wfInstructionTableStep" data-id="">

							<tr id="wfInstructionTableStepFirstRow">
								<th class="iHideStep">ID</th>
								<th style="width: 90px;" class="iActionStep">Action </th>
								<th>Name</th>
								<th>URL</th>
								<th>Reference</th>
								<th class="iHideStep">isEdited</th>
								<th class="iHideStep">isDelete</th>

							</tr>
						</table>
					</div>

				</div>
			</div>
		</div>

	</div>

	<script>

		$(document).ready(function () {
			//$.protip();
			//$('[data-toggle="tooltip"]').tooltip();
			$.protip();
			$('body').tooltip({
				selector: '.aqua-tooltip',
				placement: function (tip, element) { //$this is implicit
					if (getTextWidth(element.dataset.originalTitle) > 1250) {
						return "bottom"
					}
					else {
						return "top"
					}
				}
			});
			//$('#rulesTaskProject').on('shown', function() {
			//    if ($('#addedRuleDiv').is(':hidden')) {
			//                $('#ruleLinkDiv').css('margin-bottom', '20px');
			//            }
			//            else {
			//                $('#ruleLinkDiv').css('margin-bottom', '0px');
			//            }
			//})
			//SVGElement.prototype.getTransformToElement = SVGElement.prototype.getTransformToElement || function (toElement) { return toElement.getScreenCTM().inverse().multiply(this.getScreenCTM()); }
			let reloadAfterUpdate = false;

			var urlParams = new URLSearchParams(window.location.search);
			subID = urlParams.get("subId");
			projID = urlParams.get("projID");
			$('#projectId').val(projID);
			version = urlParams.get("version");
			wfid = urlParams.get("wfid");
			wfOwnerName = urlParams.get("wfownername").split('[')[0];
			if (wfOwnerName != "null") { $("#WFOwnerName").val(wfOwnerName); }
			else { $("#WFOwnerName").val(signumGlobal); }
			var subActivityDefID = null;
			viewFlowChartWorkOrder(projID, subID, version, wfid);

			//retrivePMDRList(projID);
			$('#editRep').on('show.bs.modal', function () {
				$(this).find('.modal-content').css({
					width: 'auto', //probably not needed
					height: 'auto', //probably not needed
					'max-width': '50%',
					'margin': 'auto'
				});
			});

			setInterval(function () {
				var isUserLoggedin = signumGlobal;
				if (isUserLoggedin == null) {
					//window.location.href = UiRootDir + "/";
					window.close();
				}
			}, 2000);


			$('#botConfigForm').on('submit', function (e) {
				e.preventDefault();
				saveBotConfig();

			});


            window.onload = function(){
	//var popup = document.getElementById('popup');
    //var overlay = document.getElementById('accordionOne');
    var openButton = document.getElementById('linkcollapse');
    document.onclick = function(e){
        if(e.target.id == 'mainDivToOverlay'){
            $('#mainDivToOverlay').removeClass('overlayWfDetailDiv');
            $('#accordionOne').removeClass('panel-collapse in');
            $('#accordionOne').addClass('panel-collapse collapse');
            $('#accordionOne')[0].style = 'height:0px;';
        }
         if(e.target.id == 'saveBtnDiv'){
            $('#mainDivToOverlay').removeClass('overlayWfDetailDiv');
            $('#accordionOne').removeClass('panel-collapse in');
            $('#accordionOne').addClass('panel-collapse collapse');
            $('#accordionOne')[0].style = 'height:0px;';
        }
        if(e.target === openButton){
         	 $('#mainDivToOverlay').addClass('overlayWfDetailDiv');
            $('#accordionOne').removeClass('panel-collapse collapse');
            $('#accordionOne').addClass('panel-collapse in');
            $('#accordionOne')[0].style = 'height:auto;';
                }
            };
            };

			//addWfDataToTempTable();
			//deleteExistingRulesFromTempTable();

		});


		function isPaste(e) {
			setTimeout(function () {
				//get the value of the input text
				var data = $('#WFName').val();
				//replace the special characters to ''
				var dataFull = data.replace(/[^\w\s]/gi, '');
				//set the new value of the input text without special characters
				$('#WFName').val(dataFull);
			});
		}
		function IsAlphaNumeric(e) {
			var specialKeys = new Array();
			specialKeys.push(8); //Backspace
			specialKeys.push(9); //Tab
			specialKeys.push(46); //Delete
			specialKeys.push(36); //Home
			specialKeys.push(35); //End
			specialKeys.push(37); //Left
			specialKeys.push(39); //Right
			var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
			var ret = ((keyCode == 32) || (keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) || (keyCode >= 97 && keyCode <= 122) || (specialKeys.indexOf(e.keyCode) != -1 && e.charCode != e.keyCode));
			// document.getElementById("error").style.display = ret ? "none" : "inline";
			return ret;

			//  if (e.which === 39)
			//    return false;
		}
		function retrivePMDRList(projID) {
			$.isf.ajax({
				url: service_java_URL + "flowchartController/getWFOwners/" + projID,
				success: function (data) {
					$('#PMDRList').html('');
					$('#PMDRList').append('<option value="' + 0 + '"></option>');
					$.each(data, function (i, d) {
						$('#PMDRList').append('<option value="' + d.SignumID + '">' + d.SignumID + ' [' + d.EmployeeName + ']</option>');

					})
				},
				error: function (xhr, status, statusText) {
					console.log('An error occurred on get Access Profile ID');
				}
			});

		}
		function updateWfOwner(signumId, wfdefId) {

			$.isf.ajax({
				url: service_java_URL + 'flowchartController/updateWFOwner/' + wfdefId + '/' + signumId,
				type: 'POST',
				crossDomain: true,
				context: this,
				contentType: "application/json",

				success: function () {
					$('#editRep').modal('hide');
					pwIsf.alert({ msg: 'Updated Workflow Owner', type: 'success' });
					//ChecK WF owner accessibility for Work instruction URL for step level

					$('#WFOwnerName').val($('#PMDRList').val());
					wfOwnerName = signumId;
					checkOwner(true);
					checkForDataNonOwner();
					window.onunload = refreshParent;
					// $("#instructionBtn").prop("disabled", false);
					function refreshParent() {
						window.opener.location.reload();
					}
				},
				error: function (xhr, status, statusText) {
					pwIsf.alert({ msg: 'Failed to Update Workflow Owner', type: 'error' });
				},
			});
		}

		//For FireFox.
		V.isSVGGraphicsElement = function (node) {
			if (!node) return false;
			node = V.toNode(node);
			// IE/Edge does not implement SVGGraphicsElement interface, thus check for `getScreenCTM` below
			return node instanceof SVGElement && typeof node.getScreenCTM === 'function';
		};

		V.prototype.getTransformToElement = function (target) {
			var node = this.node;
			if (V.isSVGGraphicsElement(target) && V.isSVGGraphicsElement(node)) {
				var targetCTM = V.toNode(target).getScreenCTM();
				var nodeCTM = node.getScreenCTM();
				if (targetCTM && nodeCTM) {
					return targetCTM.inverse().multiply(nodeCTM);
				}
			}
			// Could not get actual transformation matrix
			return V.createSVGMatrix();
		};
		//End For Firefox
		joint.setTheme('material');
		app = new App.MainView({ el: '#app' });
		themePicker = new App.ThemePicker({ mainView: app });
		window.addEventListener('load', function () {

		});
		max_id = '';
		app.graph.on('change:attrs', function (cell) { autoResize(app, cell); }); // Call autoResize function on every text change with in step boxes.

		app.paper.on('cell:pointerup', function (cellView) { callOnMouseUpOnElement(cellView); });
		newStepAddArray = [];
		app.graph.on('add', function (cell, collection, opt) {
			callAfterAddElementOnPaper(app, cell, collection, opt);
			if (cell.attributes.execType == "Automatic") {
				//  newStepAddArray = [];
				newStepAddArray.push(cell.id);
			}
		});

		//Add validate button on flowchart
		if (showValidateAdjustBtn) {
			let validationArea = $('<div class="validateArea"></div>');
			let autoAlignCheck = '<label id="toggleAutoAlign" class="joint-widget joint-theme-material" data-type="toggle" data-name="toggle" style="color:#020202;margin-top:6px;font-size:14px;margin-left:-8px;"><span>With Auto Alignment</span><div class="toggle"><input id="autoAlignCheckBox" type="checkbox" class="toggle"><span><i></i></span></div></label>';
			//let autoAlignCheck = $('<input type="checkbox" id="autoAlignment"><label for="autoAlignment">Auto Alignment</label>');
			//let validationBtn = $('<button class="btn btn-danger validateWfBtn" > Validate Workflow Before Save</button >');

			//validationArea.append(validationBtn);
			validationArea.append(autoAlignCheck);
			//let validateBtn = `<div class="validateBtnArea">< button class="btn btn-danger validateWfBtn" > Validate Workflow Before Save</button ></div >`;
			$('#app').find('.toolbar-container .group-first').append(validationArea);

			$('#toggleAutoAlign').on('change', function () {
				if ($('#autoAlignCheckBox').attr('checked') == 'checked') {
					$('#autoAlignCheckBox').attr('checked', false);
				} else {
					$('#autoAlignCheckBox').attr('checked', true);
				}
			});

			$('.validateArea .validateWfBtn').on('click', function () {
				validateAndAdjustFlowchart(app);
				isRulePresent(app);
			});
		}


		//workflow for Preview. FlowChartWorkOrderAdd
		joint.setTheme('material');
		app1 = new App.MainView({ el: '#app1' });
		$('#app1').find(".stencil-container").css("display", "none");
		$("#app1").find(".paper-container").css("width", "100%");
		$("#app1").find(".paper-container").css("left", "0");
		$("#app1").find(".paper-container").css("right", "0");
		$('#app1').find('.joint-toolbar-group').find('#toggleEditMode').hide()

		themePicker = new App.ThemePicker({ mainView: app1 });
		themePicker.render().$el.appendTo(document.body);


		app2 = new App.MainView({ el: '#app2' });
		$('#app2').find(".stencil-container").css("display", "none");
		$("#app2").find(".paper-container").css("width", "100%");
		$("#app2").find(".paper-container").css("left", "0");
		$("#app2").find(".paper-container").css("right", "0");
		$('#app2').find('.joint-toolbar-group').find('#toggleEditMode').hide()

		themePicker = new App.ThemePicker({ mainView: app2 });
		themePicker.render().$el.appendTo(document.body);
		var flag = '';
		app.paper.on('cell:pointerclick', function (cellView, evt, x, y) {
			//remove delete box handle when update attribute toggle is off.
			if (!global_toggleFlag) {
				$('.handles').find('.remove').hide();
				$('.handles').find('.unlink').hide();
				$($('*[data-attribute="responsible"]')[1]).prop('disabled', true); $($('*[data-attribute="responsible"]')[1]).parent().css('opacity', 0.4);
			}
		});


	</script>

	<!-- Local file warning: -->
	<div id="message-fs" style="display: none;">
		<p>The application was open locally using the file protocol. It is recommended to access it trough a <b>Web server</b>.</p>
		<p>Please see <a href="README.md">instructions</a>.</p>
	</div>

	<script>
		(function () {
			var fs = (document.location.protocol === 'file:');
			var ff = (navigator.userAgent.toLowerCase().indexOf('firefox') !== -1);
			if (fs && !ff) {
				(new joint.ui.Dialog({
					width: 300,
					type: 'alert',
					title: 'Local File',
					content: $('#message-fs').show()
				})).open();
			}
		})();


								//$.ajaxSetup({
								//    beforeSend: function (xhr) {


								//      //  xhr.setRequestHeader("Authorization", "Bearer " + BearerKey);
								//    }
								//});

	</script>
	<!-- Modal -->




</body>

</html>

@Scripts.Render("~/bundles/downloadTemplates")